<!DOCTYPE html>
<html>
    <head>
        <title>Best Hands</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/uikit.min.css" />
        <script src="js/uikit.min.js"></script>
        <script src="js/uikit-icons.min.js"></script>
    </head>
    <body>
    <div class="uk-container uk-container-small uk-position-relative">
        <div class="uk-card uk-card-default uk-card-body uk-margin-top">
            <h1 class="uk-card-title" style="font-size:18px">Best Hands</h1>     
            <table class="uk-table uk-table-striped uk-table-small uk-table-responsive" style="">
                <thead>
                    <td>Hand</td>
                    <td>Board</td>
                    <td>Best</td>
                    <td>Second</td>
                </thead>
                <tbody id="board"></tbody>
            </table>
            <a href="#" onclick="event.preventDefault(); download_table_as_csv('board');">Download as CSV</a>
        </div>
    </div>
        <script>
            let numbers = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            let suits = ['s','h','d','c'];

            function deal(size, exclude = []) {
                let hand = [];

                while ( hand.length < size ) {
                    let key = numbers[Math.floor(Math.random() * numbers.length)]; 
                    key += suits[Math.floor(Math.random() * suits.length)]; 

                    if (!hand.includes(key) || !exclude.includes(key)) {
                        hand.push(key);
                    }
                }
                
                return hand;
            }

            function addRow(tableID, hand, board, rowId) {
                let tableRef = document.getElementById(tableID);
                let newRow = tableRef.insertRow(-1);
                
                let handCell = newRow.insertCell(0);
                let handText = document.createTextNode(hand.join(' '));
                handCell.appendChild(handText);

                let boardCell = newRow.insertCell(1);
                let boardText = document.createTextNode(board.join(' '));
                boardCell.appendChild(boardText);

                let bestCell = newRow.insertCell(2);
                let bestInput = document.createElement("input");
                bestInput.setAttribute('type', 'text');
                bestInput.setAttribute('id', 'best'+rowId);
                bestInput.className = "uk-input";
                bestCell.appendChild(bestInput);

                let secCell = newRow.insertCell(3);
                let secInput = document.createElement("input");
                secInput.setAttribute('type', 'text');
                secInput.setAttribute('id', 'sec'+rowId);
                secInput.className = "uk-input";
                secCell.appendChild(secInput);
            }

            for (let i=0;i<20;i++) {
                let hand = deal(2);
                let board = deal(5, hand);
                addRow('board', hand, board, i);
            }


            function download_table_as_csv(table_id) {
                let rows = document.querySelectorAll('tbody#' + table_id + ' tr');
                
                let csv = [];
                for (let i = 0; i < rows.length; i++) {
                    let row = [], cols = rows[i].querySelectorAll('td');
                    for (let j = 0; j < cols.length; j++) {
                        let data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, '').replace(/(\s\s)/gm, ' ')
                        if ( data === '' ) {
                            let input = false;
                            if ( j === 2 ) {
                                input = document.getElementById('best' + i);
                            } else if ( j === 3 ) {
                                input = document.getElementById('sec' + i);
                            }

                            if (input) {
                                data = input.value;
                            }
                        }
                        
                        data = data.replace(/"/g, '""');
                        row.push('"' + data + '"');
                    }
                    csv.push(row.join());
                }
                let csv_string = csv.join('\n');
    
                let filename = 'export_' + table_id + '.csv';
                let link = document.createElement('a');
                link.style.display = 'none';
                link.setAttribute('target', '_blank');
                link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv_string));
                link.setAttribute('download', filename);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        </script>
    </body>
</html>
